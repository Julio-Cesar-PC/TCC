<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./filtragemStyle.css" rel="stylesheet">
    <link rel="stylesheet" href="/components/sideBarStyle.css">
    
    <!-- Componentes -->
    <script src="./components/dropdownArea.js"></script>
    <script src="./components/dropdownDificuldade.js"></script>
    <script src="components/sideBar.js"></script>

    <!-- Icons -->
    <script src="https://kit.fontawesome.com/fc3f8d6bba.js" crossorigin="anonymous"></script>
    <title>Filtro de Exercícios</title>
</head>
<body>
    <div class="container">
        <div class="navbar">
    
          <div id="logo">
            <a href="./parsonsProblemsPage.html">
              <img src="./assets/logoicon.png" alt="Icone do site, dois pês, representando Parsons Puzzles" height="80px">
              <p><span>Python</span> <span>Parsons</span> Puzzles</p>
            </a>
          </div>
    
            <!-- Contêiner para o sidebar -->
            <div id="sidebar-container"></div>
        </div>        
    </div>


    <h1>Filtrar Exercícios</h1>
    <div class="filter-container">
        <!-- É o componente dropDownDificuldade-->
        <div id="dropdownDificuldade"></div>

        <!-- É o componente dropDownArea -->
        <div id = "dropdownArea"></div>

        <label for="tags">Tags (separadas por vírgula):</label>
        <input type="text" id="tags" placeholder="Exemplo: fisica, matematica"><br>

        <button id="filterBtn">Filtrar Exercícios</button>
    </div>

    

    <div id="result-container">
        <table id="resultTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Enunciado</th>
                    <th>Dificuldade</th>
                    <th>Exercício</th>
                    <th>Área</th>
                    <th>Tags</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById('filterBtn').addEventListener('click', function() {
            // Capturar os filtros do usuário
            var dificuldade = document.getElementById('dificuldade').value;
            var area = document.getElementById('area').value;
            var tags = document.getElementById('tags').value;

            // Fazer a requisição GET usando os parâmetros de filtro
            fetch(`https://script.google.com/macros/s/AKfycbyPA-UzG-PVuzKK_d99wr5FS_58xsLv5yDXfIapObnJ6RD-By4EcwlX8FjUo_1sdBPp1w/exec?actionRequest=getExercicioFiltrado&dificuldade=${dificuldade}&area=${area}&tags=${tags}`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    //console.log(data.data);
                  displayResults(data.data); // Função que exibirá os resultados
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Erro ao buscar exercícios:', error);
            });
        });

        function displayResults(exercicios) {
          // Limpar a tabela de resultados anterior
          var tableBody = document.querySelector('#resultTable tbody');
          tableBody.innerHTML = '';

          // Preencher a tabela com os novos resultados
          exercicios.forEach(exercicio => {
              var row = document.createElement('tr');
              row.innerHTML = `
                  <td>${exercicio.id}</td>
                  <td>${exercicio.enunciado}</td>
                  <td>${exercicio.dificuldade}</td>
                  <td>${exercicio.exercicio}</td>
                  <td>${exercicio.area}</td>
                  <td>${exercicio.tags}</td>
              `;
              tableBody.appendChild(row);
          });
        }

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Código a ser executado após o carregamento do DOM
            appendAreaDropdown("#dropdownArea");
            appendDificuldadeDropdown("#dropdownDificuldade");
        });
        document
    </script>
</body>
</html>
